<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Krishna Team ‚Ä¢ Community</title>
    <style>
        :root {
            --royal: #2b50ff;
            --teal: #08bdbd;
            --gold: #ffd166;
            --bg: #f6f8fb;
            --card: #ffffff;
            --text: #101828;
            --muted: #667085;
            --line: #e5e7ee;
            --shadow: 0 10px 30px rgba(16, 24, 40, .08);
        }

        [data-theme="dark"] {
            --bg: #0e1320;
            --card: #11182a;
            --text: #e6e9f2;
            --muted: #9aa4b2;
            --line: #24304d;
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
            background: var(--bg);
            color: var(--text)
        }

        .wrap {
            max-width: 1100px;
            margin: 0 auto;
            padding: 16px
        }

        .card {
            background: var(--card);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 16px;
            margin-bottom: 14px
        }

        .btn {
            border: 0;
            border-radius: 12px;
            background: var(--royal);
            color: #fff;
            cursor: pointer;
            padding: 10px 14px;
            font-weight: 700
        }

        .btn.ghost {
            background: #fff;
            color: var(--royal);
            border: 1px solid var(--royal)
        }

        [data-theme="dark"] .btn.ghost {
            background: transparent;
            color: #fff;
            border: 1px solid #fff3
        }

        .btn.grey {
            background: #eef2ff;
            color: #2b50ff
        }

        [data-theme="dark"] .btn.grey {
            background: #1a2440;
            color: #e6e9f2
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid var(--line);
            background: var(--card);
            color: var(--text)
        }

        label {
            font-size: 12px;
            color: var(--muted);
            font-weight: 700;
            margin-bottom: 6px;
            display: block
        }

        .tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 0
        }

        .tabs button {
            background: var(--card);
            border: 1px solid var(--line);
            border-radius: 12px;
            padding: 8px 12px;
            color: var(--text);
            cursor: pointer
        }

        .tabs .active {
            background: linear-gradient(90deg, #f0f3ff, #ecfffb);
            border-color: #c9d1ff
        }

        [data-theme="dark"] .tabs .active {
            background: #1a2440
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px
        }

        .member {
            background: var(--card);
            border: 1px solid var(--line);
            border-radius: 14px;
            padding: 12px
        }

        .avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            object-fit: cover;
            background: #eef2ff;
            display: block
        }

        .muted {
            color: var(--muted)
        }

        .hidden {
            display: none
        }

        header {
            background: linear-gradient(90deg, #2b50ff, #08bdbd);
            color: #fff
        }

        header .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: space-between
        }

        .pill {
            background: #eef2ff;
            color: #2b50ff;
            border-radius: 999px;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 800
        }

        [data-theme="dark"] .pill {
            background: #1a2440;
            color: #e6e9f2
        }

        /* auth */
        .auth {
            min-height: 100vh;
            display: grid;
            place-items: center;
            padding: 16px
        }

        .auth .box {
            width: min(420px, 94vw);
            background: var(--card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 18px
        }

        .title {
            font-size: 22px;
            font-weight: 900;
            text-align: center
        }

        /* chat */
        .chat {
            height: 380px;
            overflow: auto;
            border: 1px solid var(--line);
            border-radius: 14px;
            background: var(--card);
            padding: 12px
        }

        .bubble {
            max-width: 70%;
            padding: 10px 12px;
            border-radius: 14px;
            margin: 6px 0;
            display: inline-block
        }

        .mine {
            background: #eef2ff;
            color: #111;
            border-top-right-radius: 4px;
            float: right;
            clear: both
        }

        .theirs {
            background: #f8fafc;
            color: #111;
            border-top-left-radius: 4px;
            float: left;
            clear: both
        }

        [data-theme="dark"] .mine {
            background: #24304d;
            color: #e6e9f2
        }

        [data-theme="dark"] .theirs {
            background: #1a2440;
            color: #e6e9f2
        }

        .bubble .name {
            font-weight: 800;
            font-size: 12px;
            margin-bottom: 4px
        }

        .bubble .time {
            font-size: 10px;
            color: var(--muted);
            margin-top: 6px
        }

        /* stories */
        .stories {
            display: flex;
            gap: 10px;
            overflow: auto;
            padding: 6px 2px
        }

        .story {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px
        }

        .ring {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            padding: 2px;
            background: conic-gradient(var(--royal), var(--teal))
        }

        .ring img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            background: #fff
        }

        .story small {
            font-size: 12px;
            color: var(--muted)
        }

        .viewer {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50
        }

        .viewer.active {
            display: flex
        }

        .viewer .frame {
            position: relative;
            width: min(92vw, 420px);
            height: min(92vh, 740px);
            background: #000;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, .6)
        }

        .viewer img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000
        }

        .viewer .caption {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            color: #fff;
            background: linear-gradient(180deg, transparent, rgba(0, 0, 0, .6));
            padding: 14px
        }

        .viewer .tapL,
        .viewer .tapR {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 50%
        }

        .viewer .tapL {
            left: 0
        }

        .viewer .tapR {
            right: 0
        }
    </style>

    <!-- Firebase (CDN Modules) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc, onSnapshot, query, orderBy, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        // --- your config (unchanged) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDm2RdsvOk8t146bdOVt3-TczKB3hvP3fg",
            authDomain: "krishna-team.firebaseapp.com",
            projectId: "krishna-team",
            storageBucket: "krishna-team.firebasestorage.app",
            messagingSenderId: "1020803458909",
            appId: "1:1020803458909:web:8d0c19d5bd6ac00aaeaab4",
            measurementId: "G-SSMJBHNN95"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // helpers
        const qs = s => document.querySelector(s);
        const qsa = s => Array.from(document.querySelectorAll(s));
        const avatarSVG = (name) => {
            const initials = name.split(' ').map(x => x[0]).slice(0, 2).join('').toUpperCase();
            const svg = encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64">
        <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#dfe4ff"/><stop offset="100%" stop-color="#d7fff6"/>
        </linearGradient></defs>
        <rect rx="32" ry="32" width="64" height="64" fill="url(#g)"/>
        <text x="50%" y="54%" text-anchor="middle" font-family="Inter,Arial" font-size="26" fill="#1d2939">${initials}</text>
      </svg>`);
            return `data:image/svg+xml,${svg}`;
        };

        // global state
        let currentUser = null;
        let currentTab = "dashboard";
        const emojiList = ["‚ú®", "üôè", "üíô", "üôÇ", "ü§î", "üòè", "ü•≤"];

        // DOM ready
        window.addEventListener('DOMContentLoaded', () => {
            qs('#seed').addEventListener('click', seedUsersOnce);
            qs('#loginBtn').addEventListener('click', login);
            qs('#loginPass').addEventListener('keydown', e => { if (e.key === 'Enter') login(); });
            qs('#forgotPassBtn').addEventListener('click', () => alert("Forgot your PIN?\nAsk Yash (Admin) or Aman (Sachiv) to reset."));
            const savedTheme = localStorage.getItem('ktm_theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            const remembered = localStorage.getItem('ktm_session');
            if (remembered) {
                getDoc(doc(db, 'users', remembered)).then(s => {
                    if (s.exists()) { currentUser = { username: remembered, ...s.data() }; startApp(); }
                });
            }
        });

        // login (username@ktm.in + 5-char PIN e.g., Y1275)
        async function login() {
            const u = qs('#loginUser').value.trim().toLowerCase();
            const p = qs('#loginPass').value.trim();
            if (!/^\w+@ktm\.in$/.test(u)) { return showAuthErr("Use username like yash@ktm.in"); }
            if (!/^[A-Z][0-9]{4}$/.test(p)) { return showAuthErr("PIN must be 1 capital letter + 4 digits (e.g., Y1275)"); }
            const ref = doc(db, 'users', u);
            const snap = await getDoc(ref);
            if (!snap.exists()) return showAuthErr("User not found.");
            const data = snap.data();
            if (data.pin !== p) return showAuthErr("Wrong PIN.");
            currentUser = { username: u, ...data };
            if (qs('#rememberMe').checked) localStorage.setItem('ktm_session', u);
            startApp();
        }
        function showAuthErr(msg) { qs('#authErr').textContent = msg; }

        // seed users (click ONCE)
        async function seedUsersOnce() {
            const list = [
                { name: "Chetna", username: "chetna@ktm.in", role: "former_leader", badges: ["Former Leader"], pin: "C1234" },
                { name: "Yash", username: "yash@ktm.in", role: "admin", badges: ["Founder", "Admin", "Former Leader"], pin: "Y1275" },
                { name: "Muskan", username: "muskan@ktm.in", role: "leader", badges: ["Leader"], pin: "M1111" },
                { name: "Aman", username: "aman@ktm.in", role: "admin", badges: ["Admin", "Sachiv"], pin: "A2222" },
                { name: "Aditi", username: "aditi@ktm.in", role: "vice", badges: ["Vice Leader"], pin: "A3333" },
                { name: "Bhoomi", username: "bhoomi@ktm.in", role: "advisor", badges: ["Advisor"], pin: "B4444" },
                { name: "Kanha", username: "kanha@ktm.in", role: "member", badges: ["Member"], pin: "K5555" },
                { name: "Jatin", username: "jatin@ktm.in", role: "member", badges: ["Member"], pin: "J6666" },
                { name: "Manan", username: "manan@ktm.in", role: "member", badges: ["Member"], pin: "M7777" },
                { name: "Anshul", username: "anshul@ktm.in", role: "member", badges: ["Member"], pin: "A8888" },
                { name: "Laksh", username: "laksh@ktm.in", role: "member", badges: ["Member"], pin: "L9999" },
                { name: "Avni", username: "avni@ktm.in", role: "member", badges: ["Member"], pin: "A0000" },
                { name: "Veeranjany", username: "veeranjany@ktm.in", role: "member", badges: ["Member"], pin: "V1212" },
            ];
            await Promise.all(list.map(u => setDoc(doc(db, 'users', u.username), { name: u.name, role: u.role, badges: u.badges, pin: u.pin, pfp: "", bio: "", dob: "", lang: "en" })));
            alert("Users seeded ‚úÖ  (Click this only once.)");
        }

        // app start
        function startApp() {
            qs('#auth').classList.add('hidden');
            qs('#app').classList.remove('hidden');
            qs('#appHeader').classList.remove('hidden');
            qs('#helloName').textContent = currentUser.name;
            qs('#userMini').innerHTML = `
      <span class="pill">${currentUser.name}</span>
      <button class="btn ghost" id="logoutBtn">Logout</button>
      <button class="btn ghost" id="themeToggle">${document.documentElement.getAttribute('data-theme') === 'dark' ? 'Light' : 'Dark'} Mode</button>`;
            qs('#logoutBtn').onclick = () => { localStorage.removeItem('ktm_session'); location.reload(); };
            qs('#themeToggle').onclick = () => {
                const cur = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', cur); localStorage.setItem('ktm_theme', cur);
                qs('#themeToggle').textContent = (cur === 'dark' ? 'Light' : 'Dark') + ' Mode';
            };

            buildTabs();
            switchTab('dashboard'); // sets buttons and renders
        }

        function buildTabs() {
            const base = [
                { id: 'dashboard', label: 'Dashboard' },
                { id: 'members', label: 'Members' },
                { id: 'chat', label: 'Chat' },
                { id: 'profile', label: 'My Profile' },
            ];
            if (currentUser.role === 'admin') base.push({ id: 'admin', label: 'Admin' });
            qs('#tabs').innerHTML = base.map(t => `<button data-tab="${t.id}" class="${currentTab === t.id ? 'active' : ''}">${t.label}</button>`).join('');
            qsa('#tabs button').forEach(b => b.onclick = () => switchTab(b.dataset.tab));
        }

        function switchTab(id) {
            currentTab = id; buildTabs();
            qsa('main section').forEach(s => s.classList.add('hidden'));
            qs(`#page-${id}`).classList.remove('hidden');
            if (id === 'dashboard') renderDashboard();
            if (id === 'members') renderMembers();
            if (id === 'chat') initChat();
            if (id === 'profile') renderProfile();
            if (id === 'admin') renderAdmin();
        }

        // DASHBOARD (stories + birthday)
        function renderDashboard() {
            renderStoriesStrip(); // realtime handled in initStories(), but we can render once
            // birthdays (optional meta doc)
            getDoc(doc(db, 'meta', 'birthdays')).then(m => {
                if (m.exists()) {
                    const map = m.data(); const d = new Date(); const key = String(d.getDate()).padStart(2, '0') + '-' + String(d.getMonth() + 1).padStart(2, '0');
                    const names = map[key] || [];
                    qs('#bdayText').innerHTML = names.length ? `üéâ Happy Birthday, <strong>${names.join(', ')}</strong>!` : 'No birthdays today. üéÇ';
                }
            }).catch(() => { qs('#bdayText').textContent = 'Birthdays will appear here.'; });
        }

        // MEMBERS
        let membersUnsub = null;
        async function renderMembers() {
            if (membersUnsub) return; // attach once
            const cont = qs('#membersGrid');
            const usersRef = collection(db, 'users');
            membersUnsub = onSnapshot(usersRef, snap => {
                const arr = []; snap.forEach(d => arr.push({ username: d.id, ...d.data() }));
                cont.innerHTML = arr.map(u => `
        <div class="member">
          <img class="avatar" src="${u.pfp || avatarSVG(u.name)}" alt="${u.name}">
          <div style="margin-top:8px"><strong>${u.name}</strong></div>
          <div class="muted"><code>${u.username}</code></div>
          <div class="muted" style="margin-top:6px">${(u.badges || []).join(' ‚Ä¢ ')}</div>
        </div>`).join('');
            });
        }

        // CHAT (realtime)
        let chatUnsub = null;
        function initChat() {
            if (chatUnsub) chatUnsub(); // rebind
            const box = qs('#chatBox');
            const qRef = query(collection(db, 'messages'), orderBy('at', 'asc'));
            chatUnsub = onSnapshot(qRef, snap => {
                box.innerHTML = Array.from(snap.docs).map(d => {
                    const m = d.data();
                    const mine = m.by === currentUser.username;
                    return `<div class="bubble ${mine ? 'mine' : 'theirs'}">
          <div class="name">${mine ? 'You' : m.name}</div>
          ${m.text}
          <div class="time">${new Date(m.at?.toDate ? m.at.toDate() : m.at).toLocaleTimeString()}</div>
        </div>`;
                }).join('');
                box.scrollTop = box.scrollHeight;
            });
            qs('#sendMsg').onclick = sendMsg;
            qs('#chatInput').onkeydown = e => { if (e.key === 'Enter') sendMsg(); };
            // emoji bar (simple)
            qs('#emojiBar').innerHTML = emojiList.map(e => `<button class="btn grey" data-e="${e}" type="button">${e}</button>`).join(' ');
            qsa('[data-e]').forEach(b => b.onclick = () => { qs('#chatInput').value += b.dataset.e; qs('#chatInput').focus(); });
        }
        async function sendMsg() {
            const text = qs('#chatInput').value.trim(); if (!text) return;
            await addDoc(collection(db, 'messages'), { by: currentUser.username, name: currentUser.name, text, at: serverTimestamp() });
            qs('#chatInput').value = '';
        }

        // PROFILE (pfp upload to Storage)
        function renderProfile() {
            qs('#pName').textContent = currentUser.name;
            qs('#pBio').value = currentUser.bio || '';
            qs('#pDob').value = currentUser.dob || '';
            qs('#pLang').value = currentUser.lang || 'en';
            qs('#pfp').src = currentUser.pfp || avatarSVG(currentUser.name);

            qs('#pfpUpload').onchange = async (e) => {
                const f = e.target.files?.[0]; if (!f) return;
                const ref = sRef(storage, `users/${currentUser.username}/pfp_${Date.now()}_${f.name}`);
                await uploadBytes(ref, f);
                const url = await getDownloadURL(ref);
                await updateDoc(doc(db, 'users', currentUser.username), { pfp: url });
                currentUser.pfp = url;
                renderProfile();
            };
            qs('#saveProfile').onclick = async () => {
                await updateDoc(doc(db, 'users', currentUser.username), {
                    bio: qs('#pBio').value.trim(),
                    dob: qs('#pDob').value.trim(),
                    lang: qs('#pLang').value
                });
                alert('Profile saved ‚úÖ');
            };
        }

        // STORIES (24h)
        let storiesUnsub = null;
        function renderStoriesStrip() { // bound in initStories
            // handled by initStories subscription
        }
        function initStories() {
            if (storiesUnsub) storiesUnsub();
            const since = Date.now() - 24 * 60 * 60 * 1000;
            const qRef = query(collection(db, 'stories'), orderBy('at', 'asc'));
            storiesUnsub = onSnapshot(qRef, snap => {
                // latest per user
                const latest = {};
                snap.forEach(d => {
                    const s = d.data();
                    const t = s.at?.toDate ? s.at.toDate().getTime() : s.at;
                    if (t > since) latest[s.by] = { id: d.id, ...s };
                });
                const vals = Object.values(latest);
                qs('#storiesStrip').innerHTML = vals.length ? vals.map(s => {
                    const nm = (s.name || '').split(' ')[0] || 'Member';
                    const thumb = s.thumb || s.media;
                    return `<div class="story">
          <div class="ring" data-user="${s.by}" onclick="openStory('${s.by}')">
            <img src="${thumb || ''}" alt="${nm}">
          </div>
          <small>${nm}</small>
        </div>`;
                }).join('') : '<div class="muted">No stories yet.</div>';
            });
        }
        // add story button
        window.addEventListener('DOMContentLoaded', () => {
            const inp = qs('#addStory');
            inp.addEventListener('change', async (e) => {
                const f = e.target.files?.[0]; if (!f) return;
                const ref = sRef(storage, `stories/${currentUser.username}/${Date.now()}_${f.name}`);
                await uploadBytes(ref, f);
                const url = await getDownloadURL(ref);
                await addDoc(collection(db, 'stories'), { by: currentUser.username, name: currentUser.name, media: url, thumb: url, cap: "", at: serverTimestamp() });
                alert('Story added for 24 hours ‚úÖ');
                e.target.value = '';
            });
            // viewer close works
            qs('#viewerClose').onclick = (ev) => { ev.stopPropagation(); qs('#viewer').classList.remove('active'); };
            qs('#viewer').onclick = (ev) => { if (ev.target === qs('#viewer')) qs('#viewer').classList.remove('active'); };
            // start realtime stories when logged in
        });
        window.openStory = async (username) => {
            const since = Date.now() - 24 * 60 * 60 * 1000;
            const qRef = query(collection(db, 'stories'), where('by', '==', username), orderBy('at', 'asc'));
            const snap = await getDocs(qRef);
            const list = [];
            snap.forEach(d => {
                const s = d.data();
                const t = s.at?.toDate ? s.at.toDate().getTime() : s.at;
                if (t > since) list.push({ id: d.id, ...s });
            });
            if (!list.length) return;
            let i = 0;
            const show = () => { qs('#viewerImg').src = list[i].media; qs('#viewerCap').textContent = list[i].cap || list[i].name; }
            show();
            qs('#viewer').classList.add('active');
            qs('#tapL').onclick = () => { i = (i - 1 + list.length) % list.length; show(); };
            qs('#tapR').onclick = () => { i = (i + 1) % list.length; show(); };
        };

        // ADMIN (PIN reset)
        async function renderAdmin() {
            const cont = qs('#usersTable');
            const snap = await getDocs(collection(db, 'users'));
            const rows = [];
            snap.forEach(d => {
                const u = d.data();
                rows.push(`<tr>
        <td style="padding:6px">${u.name}</td>
        <td style="padding:6px"><code>${d.id}</code></td>
        <td style="padding:6px">${u.role}</td>
        <td style="padding:6px"><button class="btn grey" data-reset="${d.id}">Reset PIN</button></td>
      </tr>`);
            });
            cont.innerHTML = `<div style="overflow:auto"><table style="width:100%;border-collapse:collapse">
      <thead><tr><th>Name</th><th>Username</th><th>Role</th><th>Actions</th></tr></thead>
      <tbody>${rows.join('')}</tbody></table></div>`;
            cont.querySelectorAll('[data-reset]').forEach(b => b.onclick = async () => {
                const u = b.getAttribute('data-reset');
                const pin = prompt('Enter new 5-char PIN (A1234 format):');
                if (!pin || !/^[A-Z][0-9]{4}$/.test(pin)) return alert('Invalid PIN.');
                await updateDoc(doc(db, 'users', u), { pin });
                alert('PIN updated ‚úÖ');
            });
        }

        // after login hook for stories+chat
        function afterLoginRealtime() {
            initStories();
            initChat();
            renderMembers();
        }

        // --- UI skeleton build ---
        window.addEventListener('DOMContentLoaded', () => {
            // nothing extra
        });

        // expose for tabs
        window.switchTab = switchTab;

    </script>
</head>

<body>

    <!-- AUTH -->
    <section id="auth" class="auth">
        <div class="box">
            <div class="title">Welcome to Krishna Team üíô</div>
            <p class="muted" style="text-align:center;margin-top:6px">Login with your <b>@ktm.in</b> username and 5-char
                PIN (e.g., <b>Y1275</b>).</p>

            <label>Username (e.g., yash@ktm.in)</label>
            <input id="loginUser" placeholder="username@ktm.in" autocomplete="username">

            <div style="margin-top:10px">
                <label>PIN (1 capital letter + 4 digits)</label>
                <input id="loginPass" placeholder="Y1275" autocomplete="current-password">
            </div>

            <div style="display:flex;align-items:center;justify-content:space-between;margin-top:10px">
                <label style="display:flex;align-items:center;gap:8px"><input id="rememberMe" type="checkbox"> <span
                        class="muted">Remember me</span></label>
                <div style="display:flex;gap:8px;align-items:center">
                    <button class="btn grey" id="seed" type="button" title="Writes users to Firestore (click once)">Seed
                        Users (one-time)</button>
                    <button class="btn ghost" id="forgotPassBtn" type="button">Forgot PIN?</button>
                </div>
            </div>

            <button class="btn" id="loginBtn" style="width:100%;margin-top:12px">Login</button>
            <div id="authErr" class="muted" style="margin-top:8px;color:#b42318"></div>
        </div>
    </section>

    <!-- HEADER -->
    <header id="appHeader" class="hidden">
        <div class="wrap brand">
            <div style="font-weight:900">Krishna Team ‚Ä¢ Community</div>
            <div id="userMini"></div>
        </div>
    </header>

    <!-- APP -->
    <main id="app" class="wrap hidden">

        <nav class="tabs" id="tabs"></nav>

        <!-- Dashboard -->
        <section id="page-dashboard" class="card">
            <h3 style="margin:0 0 6px">Hello <span id="helloName">Friend</span>! Ready to make a memory? üôÇ</h3>
            <div class="muted">Home for notices, memories, stories & chat.</div>

            <div class="card" style="margin-top:12px">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
                    <strong>Stories (24h)</strong>
                    <label class="btn grey"><input type="file" id="addStory" accept="image/*" hidden> Add Story</label>
                </div>
                <div id="storiesStrip" class="stories"></div>
            </div>

            <div class="card" style="margin-top:12px">
                <strong>Birthdays</strong>
                <div id="bdayText" class="muted" style="margin-top:6px">Will appear here.</div>
            </div>
        </section>

        <!-- Members -->
        <section id="page-members" class="card hidden">
            <h3 style="margin:0 0 8px">Members</h3>
            <div id="membersGrid" class="grid"></div>
        </section>

        <!-- Chat -->
        <section id="page-chat" class="card hidden">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <h3 style="margin:0">Group Chat ‚Ä¢ Krishna Team</h3>
                <span class="muted" id="typingState"></span>
            </div>
            <div id="chatBox" class="chat"></div>
            <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
                <input id="chatInput" placeholder="Write a message‚Ä¶">
                <div id="emojiBar"></div>
                <button class="btn" id="sendMsg">Send</button>
            </div>
        </section>

        <!-- Admin -->
        <section id="page-admin" class="card hidden">
            <h3 style="margin:0 0 8px">Admin Panel</h3>
            <div id="usersTable"></div>
        </section>

        <!-- Profile -->
        <section id="page-profile" class="card hidden">
            <h3 style="margin:0 0 8px">My Profile</h3>
            <div style="display:flex;gap:16px;flex-wrap:wrap">
                <div style="flex:1 1 280px;max-width:340px">
                    <img id="pfp" class="avatar" alt="avatar">
                    <div style="margin-top:8px"><label class="btn grey"><input type="file" id="pfpUpload"
                                accept="image/*" hidden> Upload Photo</label></div>
                    <div style="margin-top:8px"><strong id="pName">‚Äî</strong></div>
                </div>
                <div style="flex:2 1 320px">
                    <label>Bio</label>
                    <textarea id="pBio" rows="4" placeholder="Write something about you‚Ä¶"></textarea>
                    <div style="display:flex;gap:8px;margin-top:8px">
                        <div style="flex:1">
                            <label>Birthday (DD-MM)</label>
                            <input id="pDob" placeholder="e.g., 11-09">
                        </div>
                        <div style="flex:1">
                            <label>Language</label>
                            <select id="pLang">
                                <option value="en">English</option>
                                <option value="hi">Hindi</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn" id="saveProfile" style="margin-top:10px">Save Profile</button>
                </div>
            </div>
        </section>

    </main>

    <!-- Story viewer -->
    <div id="viewer" class="viewer">
        <div class="frame">
            <img id="viewerImg" alt="story">
            <div class="caption" id="viewerCap"></div>
            <div class="tapL" id="tapL"></div>
            <div class="tapR" id="tapR"></div>
            <button class="btn ghost" id="viewerClose" style="position:absolute;top:8px;right:8px"
                type="button">Close</button>
        </div>
    </div>

    <footer class="wrap" style="text-align:center;color:var(--muted);padding-bottom:40px">
        Built with ‚ù§Ô∏è for the Krishna Team family
    </footer>

</body>

</html>